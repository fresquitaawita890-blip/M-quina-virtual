name: PC_Roblox_Funciona_Ya
on: workflow_dispatch
jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: 1_Configurar_PC
        run: |
          net user runneradmin RobloxVM2026
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          
      - name: 2_Instalar_Ngrok_Directo
        run: |
          # Descargamos ngrok directo sin usar choco (que dio error 504)
          Invoke-WebRequest -Uri "https://bin.equinox.io/c/b342964/ngrok-v3-stable-windows-amd64.zip" -OutFile "ngrok.zip"
          Expand-Archive -Path "ngrok.zip" -DestinationPath "."
          # Configurar el Token
          .\ngrok.exe config add-authtoken 39eVkh665hfvR3NNdqK6yFbG3B7_5NqkDibvo8CtNxNEkmxwR
          # Lanzar y esperar
          Start-Process .\ngrok.exe -ArgumentList "tcp 3389"
          Write-Host "Esperando 30 segundos..."
          Start-Sleep -Seconds 30
          
      - name: 3_DAME_LA_DIRECCION
        run: |
          $address = (Invoke-RestMethod http://localhost:4040/api/tunnels).tunnels[0].public_url
          $clean = $address -replace "tcp://", ""
          echo "--------------------------------------------------"
          echo "üåê DIRECCION: $clean"
          echo "üë§ USUARIO: runneradmin"
          echo "üîë CLAVE: RobloxVM2026"
          echo "--------------------------------------------------"
          
      - name: 4_Mantener_Encendida
        run: Start-Sleep -Seconds 21600
        
